{"version":3,"sources":["components/decorators/MJMLElement.js"],"names":[],"mappings":"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","file":"components/decorators/MJMLElement.js","sourcesContent":["import _ from 'lodash'\nimport { UnknownMJMLElement } from '../../Error'\nimport { widthParser } from '../../helpers/mjAttribute'\nimport hoistNonReactStatic from 'hoist-non-react-statics'\nimport Immutable from \"immutable\"\nimport MJMLElementsCollection from '../../MJMLElementsCollection'\nimport React, { Component } from 'react'\nimport ReactDOMServer from 'react-dom/server'\n\nconst getElementWidth = ({ element, siblings, parentWidth }) => {\n  const { mjml } = element.props\n  let { width } = element.props\n\n  if (!width && mjml) {\n    width = mjml.getIn(['attributes', 'width'])\n  }\n\n  if (width == undefined) {\n    return parentWidth / siblings\n  }\n\n  const { width: parsedWidth, unit } = widthParser(width)\n\n  switch (unit) {\n    case '%':\n      return parsedWidth * parentWidth / 100\n\n    case 'px':\n    default:\n      return parsedWidth\n  }\n}\n\n// used to pass column count to children\nlet siblingCount = 1\n\nfunction createComponent(ComposedComponent, defaultMJMLDefinition) {\n\n  class MJMLElement extends Component {\n\n    static defaultMJMLDefinition = defaultMJMLDefinition;\n\n    constructor(props) {\n      super(props)\n\n      this.mjml = props.mjml || Immutable.fromJS(defaultMJMLDefinition).mergeIn(['attributes'], props)\n    }\n\n    mjAttribute = name => this.mjml.getIn(['attributes', name])\n\n    mjName = () =>  {\n      return this.mjml.get('tagName').substr(3)\n    }\n\n    mjContent = () => {\n      const content = this.mjml.get('content')\n\n      if (content) {\n        return _.trim(content)\n      }\n\n      return React.Children.map(this.props.children, child => {\n        if (typeof child === 'string') {\n          return child\n        }\n        return ReactDOMServer.renderToStaticMarkup(child)\n      })\n    }\n\n    inheritedAttributes () {\n      return this.mjml.get('inheritedAttributes').reduce((result, value) => {\n        result[value] = this.mjAttribute(value)\n\n        return result\n      }, {})\n    }\n\n    isInheritedAttributes = name => this.mjml.get('inheritedAttributes') && this.mjml.get('inheritedAttributes').includes(name)\n\n    getWidth = () => this.mjAttribute('rawPxWidth') || this.mjAttribute('width')\n\n    renderWrappedOutlookChildren = children => {\n      children = React.Children.toArray(children)\n      const realChildren = children.filter(child => child.props.mjml.get('tagName') !== 'mj-raw')\n\n      const prefix = `mj-${this.mjName()}-outlook`\n      const parentWidth = this.getWidth()\n      const siblings = realChildren.length\n      const elementsWidth = realChildren.map(element => {\n        if (this.isInheritedAttributes('width')) {\n          return parseInt(parentWidth)\n        }\n\n        return getElementWidth({ element, siblings, parentWidth })\n      })\n\n      const wrappedElements = []\n\n      if (siblings == 0) {\n        return wrappedElements\n      }\n\n      wrappedElements.push(<div key=\"outlook-open\" className={`${prefix}-open`} data-width={elementsWidth[0]} />)\n\n      let i = 0\n\n      children.forEach(child => {\n        let mjml = child.props.mjml\n\n        if (mjml.get('tagName') !== 'mj-raw') {\n          mjml = child.props.mjml.setIn(['attributes', 'rawPxWidth'], elementsWidth[i])\n\n          if (this.mjml.get('inheritedAttributes')) {\n            mjml = mjml.mergeIn(['attributes', this.inheritedAttributes()])\n          }\n\n          wrappedElements.push(React.cloneElement(child, { mjml: mjml }))\n\n          if (i < realChildren.length - 1) {\n            wrappedElements.push(<div key={`outlook-${i}`} className={`${prefix}-line`} data-width={elementsWidth[i + 1]} />)\n          }\n\n          i++\n        } else {\n          wrappedElements.push(React.cloneElement(child, { mjml: mjml }))\n        }\n      })\n\n      wrappedElements.push(<div key=\"outlook-close\" className={`${prefix}-close`} />)\n\n      return wrappedElements\n    }\n\n    paddingParser = direction => {\n      const paddingDirection = this.mjAttribute(`padding-${direction}`)\n      const padding = this.mjAttribute('padding')\n\n      if (typeof paddingDirection !== 'undefined') {\n        return parseInt(paddingDirection)\n      }\n\n      if (!padding) {\n        return 0\n      }\n\n      const paddings = padding.split(' ')\n      let directions = {}\n\n      switch (paddings.length) {\n        case 1:\n          return parseInt(padding)\n        case 2:\n          directions = {top: 0, bottom: 0, left: 1, right: 1}\n          break;\n        case 3:\n          directions = {top: 0, left: 1, right: 1, bottom: 2}\n          break;\n        case 4:\n          directions = {top: 0, right: 1, bottom: 2, left: 3}\n          break;\n      }\n\n      return parseInt(paddings[directions[direction]] || 0 )\n    }\n\n    generateChildren () {\n      const { mjml: parentMjml } = this.props\n\n      if (!parentMjml) {\n        return []\n      }\n\n      return parentMjml.get('children').map((mjml, i) => {\n        const childMjml = mjml.setIn(['attributes', 'parentWidth'], this.mjAttribute('rawPxWidth'))\n\n        const tag = childMjml.get('tagName').substr(3)\n        const Element = MJMLElementsCollection[tag]\n\n        if (!Element) {\n          throw new UnknownMJMLElement(`Could not find element for : ${tag}`)\n        }\n\n        return (\n          <Element\n            key={i}\n            mjml={childMjml}\n            parentMjml={parentMjml} />\n        )\n      })\n    }\n\n    buildProps () {\n      const { parentMjml } = this.props\n\n      const childMethods = [\n        'mjAttribute',\n        'mjContent',\n        'renderWrappedOutlookChildren'\n      ]\n\n      // assign sibling count for element and children\n      if (parentMjml && this.mjName() === 'column') {\n        siblingCount = parentMjml.get('children').size\n      }\n\n      return {\n\n        // pass all props from decorator\n        ...this.props,\n\n        // set mjName\n        mjName: this.mjName(),\n\n        // generate children\n        children: this.generateChildren(),\n\n        // siblings count, can change display\n        sibling: siblingCount,\n\n        parentWidth: this.getWidth(),\n        getPadding: this.paddingParser,\n\n        // assign helpers methods\n        ...childMethods.reduce((acc, method) => ({\n          ...acc,\n          [method]: this[method]\n        }), {})\n\n      }\n    }\n\n    render () {\n      return (\n        <ComposedComponent {...this.buildProps()} />\n      )\n    }\n\n  }\n\n  hoistNonReactStatic(MJMLElement, ComposedComponent)\n\n  return MJMLElement\n\n}\n\nexport default (defaultMJMLDefinition) => {\n  if (typeof defaultMJMLDefinition == 'function') {\n    return createComponent(defaultMJMLDefinition)\n  }\n\n  return ComposedComponent => createComponent(ComposedComponent, defaultMJMLDefinition)\n}\n"],"sourceRoot":"/source/"}