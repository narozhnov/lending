{"version":3,"sources":["mjml2html.js"],"names":[],"mappings":"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","file":"mjml2html.js","sourcesContent":["import _ from 'lodash'\nimport { EmptyMJMLError } from './Error'\nimport { html as beautify } from 'js-beautify'\nimport { parseInstance } from './helpers/mjml'\nimport defaultContainer from './configs/defaultContainer'\nimport documentParser from './documentParser'\nimport dom from './helpers/dom'\nimport getFontsImports from './helpers/getFontsImports'\nimport MJMLElementsCollection from './MJMLElementsCollection'\nimport React from 'react'\nimport ReactDOMServer from 'react-dom/server'\n\nconst debug = require('debug')('mjml-engine/mjml2html')\n\nconst mjml2html = (content, options = {}) => {\n  let parsedContent = content\n\n  if (typeof content == 'string') {\n    debug('Start parsing content')\n    parsedContent = documentParser(content)\n    debug('Content parsed.')\n  }\n\n  debug('Start rendering')\n  const html = render({ mjml: parsedContent, options })\n  debug('Done rendering')\n\n  return html\n}\n\nconst removeCDATA = str => str.replace(/<!--\\[CDATA\\[([^]*?)\\]\\]-->/gm, '$1')\n\nconst insertColumnMediaQuery = $ => {\n  const mediaQueries = []\n\n  _.each({'mj-column-per': '%', 'mj-column-px': 'px'}, (unit, className) => {\n    const columnWidths = []\n\n    $(`[class*=\"${className}\"]`).each(function () {\n      columnWidths.push($(this).data('column-width'))\n      $(this).removeAttr('data-column-width')\n    })\n\n    _.uniq(columnWidths).forEach((width) => {\n      const mediaQueryClass = `${className}-${width}`\n\n      mediaQueries.push(`.${mediaQueryClass}, * [aria-labelledby=\"${mediaQueryClass}\"] { width:${width}${unit}!important; }`)\n    })\n  })\n\n  if (mediaQueries.length > 0) {\n    const mediaQuery = `<style type=\"text/css\">\n  @media only screen and (min-width:480px) {\n    ${mediaQueries.join('\\n')}\n  }\n</style>\\n`\n\n    $('head').append(mediaQuery)\n  }\n\n  return $\n}\n\nconst fixOutlookLayout = $ => {\n  const bodyWidth = $('.mj-body').data('width')\n\n  $('.mj-body').removeAttr('data-width')\n\n  $('.mj-section-outlook-background').each(function () {\n    const url = $(this).data('url')\n    const width = $(this).data('width')\n\n    $(this)\n      .removeAttr('class')\n      .removeAttr('data-url')\n      .removeAttr('data-width')\n\n    if (!url) {\n      return\n    }\n\n    $(this).before(`<!--[if gte mso 9]>\n      <v:rect xmlns:v=\"urn:schemas-microsoft-com:vml\" fill=\"true\" stroke=\"false\" style=\"width:${width}px;\">\n        <v:fill origin=\"0.5, 0\" position=\"0.5,0\" type=\"tile\" src=\"${url}\" />\n        <v:textbox style=\"mso-fit-shape-to-text:true\" inset=\"0,0,0,0\">\n      <![endif]-->`)\n\n    $(this).after(`<!--[if gte mso 9]>\n        </v:textbox>\n      </v:rect>\n      <![endif]-->`)\n  })\n\n  $('.mj-body-outlook-open').each(function () {\n    $(this).replaceWith(`<!--[if mso]>\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"${bodyWidth}\" align=\"center\" style=\"width:${bodyWidth}px;\"><tr><td>\n      <![endif]-->`)\n  })\n\n  $('.mj-body-outlook-line').each(function () {\n    $(this).replaceWith(`<!--[if mso]>\n      </td></tr></table>\n      <![endif]-->\n      <!--[if mso]>\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"${bodyWidth}\" align=\"center\" style=\"width:${bodyWidth}px;\"><tr><td>\n      <![endif]-->`)\n  })\n\n  $('.mj-body-outlook-close').each(function () {\n    $(this).replaceWith(`<!--[if mso]>\n      </td></tr></table>\n      <![endif]-->`)\n  })\n\n  $('.mj-section-outlook-open').each(function () {\n    const $columnDiv = $(this).next()\n\n    $(this).replaceWith(`<!--[if mso]>\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"vertical-align:${$columnDiv.data('vertical-align')};width:${parseInt($(this).data('width'))}px;\">\n      <![endif]-->`)\n\n    $columnDiv.removeAttr('data-vertical-align')\n  })\n\n  $('.mj-section-outlook-line').each(function () {\n    const $columnDiv = $(this).next()\n\n    $(this).replaceWith(`<!--[if mso]>\n    </td><td style=\"vertical-align:${$columnDiv.data('vertical-align')};width:${parseInt($(this).data('width'))}px;\">\n      <![endif]-->`)\n\n    $columnDiv.removeAttr('data-vertical-align')\n  })\n\n  $('.mj-section-outlook-close').each(function () {\n    $(this).replaceWith(`<!--[if mso]>\n      </td></tr></table>\n      <![endif]-->`)\n  })\n\n  $('.mj-social-outlook-open').each(function () {\n    $(this).replaceWith(`<!--[if mso]>\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\"><tr><td>\n      <![endif]-->`)\n  })\n\n  $('.mj-social-outlook-line').each(function () {\n    $(this).replaceWith(`<!--[if mso]>\n      </td><td>\n      <![endif]-->`)\n  })\n\n  $('.mj-social-outlook-close').each(function () {\n    $(this).replaceWith(`<!--[if mso]>\n      </td></tr></table>\n      <![endif]-->`)\n  })\n\n  $('.mj-divider-outlook').each(function () {\n    const insertNode = `<table align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"${$(this).attr('style')}\" width=\"${$(this).data('divider-width')}\"><tr><td>&nbsp;</td></tr></table>`\n\n    $(this).removeAttr('data-divider-width')\n\n    $(this)\n      .removeAttr('class')\n      .after(`<!--[if mso]>${insertNode}<![endif]-->`)\n  })\n\n  return $\n}\n\nconst fixLegacyAttrs = $ => {\n  const legacyAttrs = ['align', 'valign', 'bgcolor', 'border', 'background']\n\n  $('body').css({ background: $('.mj-body').data('background-color') })\n  $('.mj-body').removeAttr('data-background-color')\n\n  // https://github.com/facebook/react/issues/140 ...\n  // server side workaround to allow custom tags.\n  legacyAttrs.forEach(attr => {\n    const dataAttr = `data-legacy-${attr}`\n\n    $(`[${dataAttr}]`).each(function () {\n      $(this).attr(attr, $(this).attr(dataAttr))\n      $(this).removeAttr(dataAttr)\n    })\n  })\n\n  return $\n}\n\nconst clean = $ => {\n  $('body').each(function () {\n    if ($(this).attr('style') === '') {\n      $(this).removeAttr('style')\n    }\n  })\n\n  $('.mj-body')\n    .removeAttr('class')\n    .each(function () {\n      if ($(this).attr('style') === '') {\n        $(this).removeAttr('style')\n      }\n    })\n\n  return $\n}\n\nconst render = ({ mjml, options }) => {\n  let content = ''\n\n  if (mjml) {\n    debug('Create root React element')\n    const rootElemComponent = React.createElement(MJMLElementsCollection[mjml.tagName.substr(3)], { mjml: parseInstance(mjml) })\n\n    debug('Render to static markup')\n    content = ReactDOMServer.renderToStaticMarkup(rootElemComponent)\n  } else {\n    throw (new EmptyMJMLError(`.render: No MJML to render in options ${options.toString()}`))\n  }\n\n  debug('React rendering done. Continue with special overrides.')\n  let $ = dom.parseHTML(defaultContainer({ title: options.title, content, fonts: getFontsImports({ content }) }))\n\n  $('.mj-raw').each(function () {\n    $(this).replaceWith($(this).html())\n  })\n\n  $ = insertColumnMediaQuery($)\n  $ = fixLegacyAttrs($)\n  $ = fixOutlookLayout($)\n  $ = clean($)\n\n  let html = dom.getHTML($)\n\n  html = removeCDATA(html)\n\n  if (options.beautify && beautify) {\n    html = beautify(html, {\n      indent_size: 2,\n      wrap_attributes_indent_size: 2\n    })\n  }\n\n  if (options.minify) {\n    const { minify } = require('html-minifier')\n\n    html = minify(html, {\n      collapseWhitespace: true,\n      removeEmptyAttributes: true,\n      minifyCSS: true\n    })\n  }\n\n  return html\n}\n\nexport default mjml2html\n"],"sourceRoot":"/source/"}